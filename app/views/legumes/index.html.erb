<%= render 'shared/navbar' %>
<div class="container mt-4">
  <h2>Les légumes</h2>
  <% h = Hash.new { |h,k| h[k] = "".to_i } %>
</div>
<div class="img-legumes">
  <%= image_tag "radis.jpg", class: "radis" %>
  <%= image_tag "aubergine.jpg", class: "aubergine" %>
  <%= image_tag "oignon.jpg", class: "oignon" %>
</div>
<div class="container">
  <div class="tous-legumes">
    <div class="liste-legume mr-3">
      <ul>
        <% @legumes.first(28).each do |legume| %>
          <% duree = [] %>
          <% planches = [] %>
          <li>
            <% legume.activites.each do |activite| %>
              <% planches << activite.planche.nom %>
              <% duree << activite.heure_fin - activite.heure_debut %>
            <% end %>
            <% duree = duree.sum %>
            <% h[legume.nom] += duree %>
            <div class="wrapper-legumes">
              <div><%= link_to legume_path(legume) do %> <%= legume.nom %> <% end %> </div>
              <div><%= planches.join(", ") %></div>
              <div><%= Time.at(duree).utc.strftime("%Hh%M") %></div>
              <div><%= rand(20..500) %>,<%= rand(10..99) %> €</div>
              <div>
                <button type="button" data-toggle="modal" data-target="#ModalCenter<%= legume.id %>">
                  <% legume.commentaires.each do |commentaire| %>
                    <% unless commentaire.description.empty? %>
                      <i class="fas fa-comment-alt"></i>
                    <% end %>
                  <% end %>
                </button>
              </div>
              <div class="modal fade" id="ModalCenter<%= legume.id %>" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="modalLongTitle"><%= legume.nom %></h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body commentaires-liste">
                      <ul>
                        <% legume.commentaires.each do |commentaire| %>
                          <% unless commentaire.description.empty? %>
                            <li>
                              <div class="date-commentaire"><%= commentaire.activite.date.strftime("%d/%m") %></div>
                              <div><%= commentaire.description %></div>
                            </li>
                          <% end %>
                        <% end %>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    </div>

    <div class="liste-legume ml-3">
      <ul>
        <% @legumes.last(28).each do |legume| %>
          <% duree = [] %>
          <% planches = [] %>
          <li>
            <% legume.activites.each do |activite| %>
              <% planches << activite.planche.nom %>
              <% duree << activite.heure_fin - activite.heure_debut %>
            <% end %>
            <% duree = duree.sum %>
            <% h[legume.nom] += duree %>
            <div class="wrapper-legumes">
              <div><%= link_to legume_path(legume) do %> <%= legume.nom %> <% end %></div>
              <div><%= planches.join(", ") %></div>
              <div><%= Time.at(duree).utc.strftime("%Hh%M") %></div>
              <div><%= rand(20..500) %>,<%= rand(10..99) %> €</div>
              <div>
                <% legume.commentaires.each do |commentaire| %>
                  <% unless commentaire.description.empty? %>
                    <i class="fas fa-comment-alt"></i>
                  <% end %>
                <% end %>
              </div>
              <div class="modal fade" id="ModalCenter<%= legume.id %>" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="modalLongTitle"><%= legume.nom %></h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <ul>
                        <% legume.commentaires.each do |commentaire| %>
                          <% unless commentaire.description.empty? %>
                            <li>
                              <div class="date-commentaire"><%= commentaire.activite.date.strftime("%d/%m") %></div>
                              <div><%= commentaire.description %></div>
                            </li>
                          <% end %>
                        <% end %>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>
